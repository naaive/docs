# Distributed System

## 度量指标

### 性能（Performance）

性能的度量指标:

- 吞吐量:广义上讲，单位时间完成的工作量。比如tps,qps
- 响应时间:从用户使用体验的角度来看，200ms 是第一个分界点：200ms 之内，用户是感觉不到延迟的，就像是瞬时发生的一样。而 1s 是另外一个分界点：接口的响应时间在 1s 之内时，虽然用户可以感受到一些延迟，但却是可以接受的，超过 1s 之后用户就会有明显等待的感觉，等待时间越长，用户的使用体验就越差。所以，健康系统的 99 分位值的响应时间通常需要控制在 200ms 之内，而不超过 1s 的请求占比要在 99.99% 以上。

方案：

- 提升并行能力
- 减少单次任务响应时间（缓存：提高读性能，消息队列：提高写性能）

### 可扩展性（Scalability）
#### 水平扩展
**有状态**： 如存储层，可通过拆分（按业务、数据量等维度）

**无状态**：如业务层，可通过拆分更细粒度的扩展（按分层、业务）

#### 垂直扩展
堆机器

### 可用性（Availability）
通常来讲，一个高并发大流量的系统，系统出现故障比系统性能低更损伤用户的使用体验。
方案：
可从**系统设计**和**运维**角度出发

**系统设计**：
failover（故障转移）：

- 对等节点，负载均衡
- 不对等节点，选举

超时控制：
通过收集系统之间的调用日志，统计比如说 99% 的响应时间是怎样的，然后依据这个时间来指定超时时间

降级：
保证核心服务的稳定而牺牲非核心服务的做法

限流：
对并发的请求进行限速来保护系统

### 一致性（Consistency）

为了提升**可用性**，不可避免使用副本机制，从而引发一致性问题。

## 总结

因果关系：

- 高可扩展性=>高性能
- 可用性需一致性支持
